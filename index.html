<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Yuvia Flight Concierge</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap');

    :root {
      --bg-primary: #F7F4EF;
      --bg-secondary: #EEF3F1;
      --bg-card: rgba(252, 249, 244, 0.9);
      --border-soft: #E2E8F0;
      --text-primary: #1F2733;
      --text-secondary: #6B7280;
      --accent-primary: #11A26A;
      --accent-primary-dark: #0B7C4E;
      --accent-secondary: #F97316;
      --accent-sun: #FACC6B;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Manrope', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(900px 900px at -10% -20%, #E7FFF3 0, transparent 60%),
        radial-gradient(900px 900px at 110% 0%, #FFEEDC 0, transparent 60%),
        radial-gradient(1200px 1000px at 50% 110%, #E3F2FF 0, #F7F4EF 50%);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }

    a { color: inherit; text-decoration: none; }
    button { font-family: inherit; }
    input, select { font-family: inherit; }

    .page {
      min-height: 100vh;
      position: relative;
    }

    .glow-blob {
      position: fixed;
      width: 480px;
      height: 480px;
      border-radius: 50%;
      filter: blur(60px);
      opacity: 0.6;
      pointer-events: none;
      z-index: -1;
    }
    .glow-1 {
      background: rgba(17, 162, 106, 0.15);
      top: -160px;
      left: -120px;
    }
    .glow-2 {
      background: rgba(249, 115, 22, 0.12);
      top: -120px;
      right: -160px;
    }
    .glow-3 {
      background: rgba(250, 204, 107, 0.18);
      bottom: -140px;
      left: 20%;
    }

    .top-nav {
      padding: 16px 24px;
    }
    .top-nav-inner {
      max-width: 1280px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }
    .logo-wrap {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo-circle {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background:
        radial-gradient(circle at 20% 20%, #FACC6B 0, transparent 45%),
        linear-gradient(135deg, #11A26A 0%, #F97316 55%, #FACC6B 100%);
      box-shadow:
        0 10px 25px rgba(17, 162, 106, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.6);
    }
    .logo-text-main {
      font-weight: 700;
      font-size: 20px;
      letter-spacing: 0.03em;
    }
    .logo-text-sub {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .content-wrap {
      max-width: 1280px;
      margin: 0 auto;
      padding: 8px 16px 40px;
    }

    .card {
      position: relative;
      background: var(--bg-card);
      border-radius: 26px;
      padding: 26px 26px 28px;
      box-shadow:
        0 24px 80px rgba(15, 23, 42, 0.16),
        0 0 0 1px rgba(255, 255, 255, 0.80);
      backdrop-filter: blur(18px);
      border: 1px solid rgba(255, 255, 255, 0.4);
      overflow: hidden;
      animation: card-pop 0.45s ease-out;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      border: 1px solid rgba(255, 255, 255, 0.65);
      pointer-events: none;
      mix-blend-mode: soft-light;
    }

    @keyframes card-pop {
      from { opacity: 0; transform: translateY(16px) scale(0.98); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    .card-inner-header {
      display: flex;
      justify-content: space-between;
      gap: 24px;
      margin-bottom: 18px;
      align-items: flex-start;
    }
    .intro-title {
      font-size: 26px;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 6px;
    }
    .intro-sub {
      font-size: 14px;
      color: var(--text-secondary);
      max-width: 520px;
    }
    .hero-bird {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .hero-bird img {
      width: 72px;
      height: auto;
      filter: drop-shadow(0 22px 40px rgba(15, 23, 42, 0.35));
    }
    .hero-bird-text {
      font-size: 12px;
      color: var(--text-secondary);
      max-width: 180px;
      line-height: 1.4;
    }

    .tabs {
      display: inline-flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 18px;
      padding: 4px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.8);
      box-shadow: 0 10px 35px rgba(148, 163, 184, 0.18);
    }
    .tab-btn {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      background: transparent;
      cursor: pointer;
      color: var(--text-secondary);
      position: relative;
      transition: color 0.2s, transform 0.15s;
    }
    .tab-btn::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(120deg, rgba(17, 162, 106, 0.09), rgba(249, 115, 22, 0.09));
      opacity: 0;
      transition: opacity 0.2s;
      z-index: -1;
    }
    .tab-btn:hover {
      transform: translateY(-1px);
      color: var(--text-primary);
    }
    .tab-btn.active {
      background: #FFFFFF;
      color: var(--text-primary);
      box-shadow: 0 8px 25px rgba(148, 163, 184, 0.18);
    }
    .tab-btn.active::before {
      opacity: 1;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .form-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
      min-width: 0;
    }
    .field-label {
      font-size: 12px;
      color: var(--text-secondary);
    }
    .field-input {
      padding: 11px 13px;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      font-size: 14px;
      background: rgba(255, 255, 255, 0.9);
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
    }
    .field-input:focus {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 1px rgba(17, 162, 106, 0.2);
      background: #FFFFFF;
    }

    .section-title {
      font-weight: 600;
      font-size: 13px;
      margin-top: 16px;
      margin-bottom: 8px;
    }

    .chip-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .chip {
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid rgba(226, 232, 240, 0.9);
      font-size: 13px;
      background: rgba(255, 255, 255, 0.95);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s, transform 0.15s;
    }
    .chip input { margin: 0; }
    .chip:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(148, 163, 184, 0.25);
    }
    .chip-toggle.active {
      background: linear-gradient(135deg, #FFFFFF 0%, #EEF3F1 100%);
      border-color: var(--accent-primary);
      box-shadow: 0 8px 22px rgba(17, 162, 106, 0.2);
    }

    .form-footer {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .form-hint {
      font-size: 13px;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .form-hint::before {
      content: "‚ú®";
    }
    .btn-primary {
      padding: 10px 22px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background-image: linear-gradient(120deg, #11A26A, #0B7C4E);
      color: #FFFFFF;
      box-shadow:
        0 14px 35px rgba(17, 162, 106, 0.48),
        0 0 0 1px rgba(255, 255, 255, 0.4);
      transition: transform 0.12s ease-out, box-shadow 0.18s ease-out, filter 0.18s;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow:
        0 18px 40px rgba(17, 162, 106, 0.6),
        0 0 0 1px rgba(255, 255, 255, 0.45);
      filter: brightness(1.02);
    }
    .btn-primary[disabled] {
      background-image: linear-gradient(120deg, #0B7C4E, #0B7C4E);
      box-shadow: 0 8px 22px rgba(15, 23, 42, 0.3);
      cursor: default;
      opacity: 0.9;
      transform: none;
    }

    .layout-results {
      margin-top: 20px;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(0, 1.05fr);
      gap: 20px;
    }
    @media (max-width: 900px) {
      .layout-results {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .results-header {
      margin-bottom: 10px;
      font-size: 13px;
      color: var(--text-secondary);
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
    }

    .route-card {
      position: relative;
      border-radius: 18px;
      border: 1px solid rgba(226, 232, 240, 0.9);
      padding: 14px 14px 14px 18px;
      margin-bottom: 10px;
      cursor: pointer;
      background: linear-gradient(135deg, #FFFFFF 0%, #F9FAFB 100%);
      display: flex;
      flex-direction: column;
      gap: 8px;
      transition: box-shadow 0.18s, border-color 0.18s, transform 0.12s;
      overflow: hidden;
    }
    .route-card::before {
      content: "";
      position: absolute;
      left: 0;
      top: 14px;
      bottom: 14px;
      width: 3px;
      border-radius: 999px;
      background: linear-gradient(180deg, #11A26A, #F97316);
      opacity: 0.7;
    }
    .route-card.selected {
      border-color: rgba(17, 162, 106, 0.8);
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.16);
      transform: translateY(-1px);
    }
    .route-card:hover {
      box-shadow: 0 14px 32px rgba(148, 163, 184, 0.42);
      transform: translateY(-1px);
    }
    .route-card-header {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: flex-start;
    }
    .route-title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .route-price-block {
      text-align: right;
      min-width: 110px;
    }
    .route-price {
      font-weight: 700;
      font-size: 16px;
    }

    .btn-ghost {
      margin-top: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(226, 232, 240, 0.95);
      background: rgba(255, 255, 255, 0.9);
      font-size: 12px;
      cursor: pointer;
      transition: background 0.18s, border-color 0.18s, transform 0.12s, box-shadow 0.18s;
    }
    .btn-ghost:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 18px rgba(148, 163, 184, 0.35);
      border-color: rgba(148, 163, 184, 0.8);
    }
    .btn-ghost.active {
      border-color: var(--accent-primary);
      background: #EEF3F1;
    }

    .timeline-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    .timeline-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent-primary);
    }
    .timeline-bar {
      position: relative;
      height: 6px;
      border-radius: 999px;
      background: #E5E7EB;
      overflow: hidden;
    }
    .timeline-segment {
      position: absolute;
      top: 0;
      bottom: 0;
    }

    .pill {
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 11px;
      display: inline-flex;
      align-items: center;
    }

    .btn-outline {
      margin-top: 10px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: rgba(255, 255, 255, 0.95);
      font-size: 13px;
      cursor: pointer;
      transition: box-shadow 0.18s, transform 0.12s, border-color 0.18s;
    }
    .btn-outline:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 22px rgba(148, 163, 184, 0.35);
      border-color: rgba(148, 163, 184, 0.9);
    }
    .btn-outline-primary {
      border: none;
      background-image: linear-gradient(120deg, #11A26A, #0B7C4E);
      color: #FFFFFF;
      margin-left: 10px;
      box-shadow: 0 14px 35px rgba(17, 162, 106, 0.5);
    }
    .btn-outline-primary:hover {
      box-shadow: 0 18px 40px rgba(17, 162, 106, 0.6);
    }

    .yuvia-panel {
      background: linear-gradient(135deg, rgba(238, 243, 241, 0.96), rgba(241, 248, 246, 0.98));
      border-radius: 20px;
      padding: 16px;
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 12px;
      box-shadow: 0 12px 34px rgba(148, 163, 184, 0.35);
      border: 1px solid rgba(255, 255, 255, 0.7);
    }
    .yuvia-panel-title {
      font-weight: 700;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .yuvia-panel-title::before {
      content: "üïäÔ∏è";
      font-size: 16px;
    }
    .yuvia-bubble {
      padding: 12px;
      border-radius: 14px;
      background: #FFFFFF;
      font-size: 14px;
      box-shadow: 0 8px 24px rgba(148, 163, 184, 0.28);
    }
    .yuvia-footer {
      margin-top: auto;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .compare-drawer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(252, 249, 244, 0.98);
      border-top: 1px solid rgba(226, 232, 240, 0.9);
      box-shadow: 0 -16px 40px rgba(15, 23, 42, 0.28);
      padding: 16px;
      z-index: 40;
      display: none;
      backdrop-filter: blur(18px);
    }
    .compare-drawer.active { display: block; }
    .compare-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
    }
    .compare-list {
      display: flex;
      gap: 16px;
      overflow-x: auto;
    }
    .compare-card {
      min-width: 220px;
      border-radius: 16px;
      border: 1px solid rgba(226, 232, 240, 0.95);
      padding: 10px;
      font-size: 13px;
      background: #FFFFFF;
      box-shadow: 0 10px 26px rgba(148, 163, 184, 0.3);
    }

    .trip-bar {
      position: fixed;
      left: 16px;
      right: 16px;
      bottom: 76px;
      max-width: 1280px;
      margin: 0 auto;
      padding: 12px 18px;
      border-radius: 999px;
      background: linear-gradient(120deg, rgba(255, 255, 255, 0.96), rgba(238, 243, 241, 0.98));
      box-shadow: 0 18px 50px rgba(15, 23, 42, 0.32);
      border: 1px solid rgba(226, 232, 240, 0.9);
      display: none;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      gap: 12px;
      z-index: 35;
      backdrop-filter: blur(14px);
    }
    .trip-bar.active { display: flex; }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      backdrop-filter: blur(10px);
    }
    .modal-backdrop.active {
      display: flex;
    }
    .modal {
      background: #FFFFFF;
      border-radius: 22px;
      max-width: 640px;
      width: 100%;
      max-height: 85vh;
      overflow: auto;
      padding: 20px;
      box-shadow: 0 24px 70px rgba(15, 23, 42, 0.55);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .segment-card {
      border-radius: 16px;
      border: 1px solid rgba(226, 232, 240, 0.95);
      padding: 12px;
      margin-bottom: 10px;
      font-size: 13px;
      background: linear-gradient(135deg, #FFFFFF 0%, #F9FAFB 100%);
      box-shadow: 0 8px 24px rgba(148, 163, 184, 0.3);
    }

    .hidden { display: none !important; }

    @media (max-width: 640px) {
      .card {
        padding: 18px 16px 22px;
        border-radius: 22px;
      }
      .card-inner-header {
        flex-direction: column;
      }
      .hero-bird {
        align-self: flex-end;
      }
      .tabs {
        width: 100%;
        justify-content: space-between;
      }
      .trip-bar {
        bottom: 90px;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <div class="glow-blob glow-1"></div>
  <div class="glow-blob glow-2"></div>
  <div class="glow-blob glow-3"></div>

  <header class="top-nav">
    <div class="top-nav-inner">
      <div class="logo-wrap">
        <div class="logo-circle"></div>
        <div>
          <div class="logo-text-main">Yuvia</div>
          <div class="logo-text-sub">—É–º–Ω—ã–π —Ç—Ä–µ–≤–µ–ª-–∫–æ–Ω—Å—å–µ—Ä–∂</div>
        </div>
      </div>
    </div>
  </header>

  <main class="content-wrap">
    <section class="card">
      <div class="card-inner-header">
        <div>
          <div class="intro-title">–ü–æ–¥–æ–±—Ä–∞—Ç—å –ø–µ—Ä–µ–ª—ë—Ç —Å Yuvia</div>
          <div class="intro-sub">
            –ù–µ —Ç–æ–ª—å–∫–æ —Ü–µ–Ω–∞, –Ω–æ –∏ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ: —è –ø–æ–¥—Å–≤–µ—á—É –Ω–æ—á–Ω—ã–µ –≤—ã–ª–µ—Ç—ã,
            —Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—ã–∫–æ–≤–∫–∏ –∏ –ø–æ–º–æ–≥—É –≤—ã–±—Ä–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç –ø–æ–¥ —Ç–≤–æ–π —Å—Ç–∏–ª—å.
          </div>
        </div>
        <div class="hero-bird">
          <img src="Logo-bird.png" alt="Yuvia" />
          <div class="hero-bird-text">
            –¢–≤–æ–π –ª–∏—á–Ω—ã–π —Ç—Ä–µ–≤–µ–ª-–∫–æ–Ω—Å—å–µ—Ä–∂: —É–º–µ–µ—Ç –±—ã—Ç—å –∏ –≤ –±–∏–∑–Ω–µ—Å-–ª–∞—É–Ω–∂–µ, –∏ —Å
            –≥–∏—Ç–∞—Ä–æ–π –≤ –≥–æ—Ä–∞—Ö.
          </div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab-btn active" data-tab="search">–ü–æ–¥–æ–±—Ä–∞—Ç—å —Ä–µ–π—Å—ã</button>
        <button class="tab-btn" data-tab="direction">–ü–æ–¥–æ–±—Ä–∞—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
        <button class="tab-btn" data-tab="ticket">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–π –±–∏–ª–µ—Ç</button>
      </div>

      <!-- –¢–ê–ë 1: –ü–û–ò–°–ö –†–ï–ô–°–û–í -->
      <div class="tab-content active" id="tab-search">
        <form id="search-form">
          <div class="form-row">
            <div class="field">
              <label class="field-label">–û—Ç–∫—É–¥–∞</label>
              <input class="field-input" id="from-input" value="–ú–æ—Å–∫–≤–∞" placeholder="–ì–æ—Ä–æ–¥ –≤—ã–ª–µ—Ç–∞">
            </div>
            <div class="field">
              <label class="field-label">–ö—É–¥–∞</label>
              <input class="field-input" id="to-input" value="–ö–∞–∑–∞–Ω—å" placeholder="–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è">
            </div>
            <div class="field" style="max-width:180px;">
              <label class="field-label">–î–∞—Ç–∞ –≤—ã–ª–µ—Ç–∞</label>
              <input class="field-input" type="date" id="date-input">
            </div>
            <div class="field" style="max-width:140px;">
              <label class="field-label">–ü–∞—Å—Å–∞–∂–∏—Ä—ã</label>
              <input class="field-input" type="number" min="1" max="9" id="passengers-input" value="1">
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:12px;align-items:center;">
            <label style="font-size:13px;color:var(--text-secondary);">
              <input type="checkbox" id="flexible-input" checked style="margin-right:6px;">
              –ú–æ–∂–Ω–æ —Å–¥–≤–∏–Ω—É—Ç—å –¥–∞—Ç—ã –Ω–∞ ¬±3 –¥–Ω—è, –µ—Å–ª–∏ —Ç–∞–∫ –±—É–¥–µ—Ç —É–¥–æ–±–Ω–µ–µ/–¥–µ—à–µ–≤–ª–µ
            </label>
          </div>

          <div class="section-title">–°—Ç–∏–ª—å –ø–æ–µ–∑–¥–∫–∏</div>
          <div class="chip-row">
            <button type="button" class="chip chip-toggle" data-priority="price">–°—ç–∫–æ–Ω–æ–º–∏—Ç—å</button>
            <button type="button" class="chip chip-toggle active" data-priority="balance">–ë–∞–ª–∞–Ω—Å</button>
            <button type="button" class="chip chip-toggle" data-priority="comfort">–ö–æ–º—Ñ–æ—Ä—Ç –∏ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ</button>
          </div>

          <div class="section-title">–¢–≤–æ–∏ –æ—â—É—â–µ–Ω–∏—è –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã</div>
          <div class="chip-row">
            <label class="chip">
              <input type="checkbox" id="pref-night" checked>
              –ò–∑–±–µ–≥–∞—Ç—å –Ω–æ—á–Ω—ã—Ö –ø–µ—Ä–µ–ª—ë—Ç–æ–≤
            </label>
            <label class="chip">
              <input type="checkbox" id="pref-short" checked>
              –ù–µ –ª—é–±–ª—é –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Ç—ã–∫–æ–≤–∫–∏
            </label>
            <label class="chip">
              <input type="checkbox" id="pref-afraid">
              –ë–æ—é—Å—å –ø–µ—Ä–µ—Å–∞–¥–æ–∫
            </label>
            <label class="chip">
              <input type="checkbox" id="pref-overnight" checked>
              –ù–µ —Ö–æ—á—É –Ω–æ—á–µ–≤–∞—Ç—å –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç—É
            </label>
          </div>

          <div class="form-footer">
            <div class="form-hint">
              Yuvia –∑–∞–ø–æ–º–Ω–∏—Ç —Ç–≤–æ–π —Å—Ç–∏–ª—å –∏ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –ø–æ–¥—Å—Ç—Ä–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
            </div>
            <button type="submit" class="btn-primary" id="search-btn">
              –ü–æ–¥–æ–±—Ä–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã
            </button>
          </div>
        </form>

        <div id="results-block" style="margin-top:20px;display:none;">
          <div class="layout-results">
            <div>
              <div class="results-header">
                <span id="results-count"></span>
                <span>–ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–ø—Ä–∞–≤–∞.</span>
              </div>
              <div id="routes-list"></div>
              <div id="routes-actions" style="display:none;">
                <button type="button" class="btn-outline" id="details-btn">
                  –û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞
                </button>
                <button type="button" class="btn-outline btn-outline-primary" id="save-trip-btn">
                  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –º–∞—Ä—à—Ä—É—Ç –ø–æ–µ–∑–¥–∫–∏
                </button>
              </div>
            </div>
            <div>
              <div id="yuvia-panel" class="yuvia-panel">
                <!-- –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –¢–ê–ë 2: –ü–û–î–û–ë–†–ê–¢–¨ –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ï -->
      <div class="tab-content" id="tab-direction">
        <p style="font-size:14px;margin-top:0;margin-bottom:12px;">
          –ó–¥–µ—Å—å –ø–æ–∑–∂–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤–∫–ª—é—á–∏—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π –ø–æ–¥–±–æ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π ¬´–∫—É–¥–∞-–Ω–∏–±—É–¥—å¬ª.
          –°–µ–π—á–∞—Å —ç—Ç–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è –∑–∞–≥–æ—Ç–æ–≤–∫–∞, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å UX.
        </p>
        <div class="form-row">
          <div class="field">
            <label class="field-label">–û—Ç–∫—É–¥–∞ –≤—ã–µ–∑–∂–∞–µ—à—å</label>
            <input class="field-input" placeholder="–ú–æ—Å–∫–≤–∞">
          </div>
          <div class="field" style="max-width:180px;">
            <label class="field-label">–ö–æ–≥–¥–∞</label>
            <input class="field-input" type="date">
          </div>
          <div class="field" style="max-width:200px;">
            <label class="field-label">–ë—é–¥–∂–µ—Ç –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞</label>
            <input class="field-input" type="number" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 15000">
          </div>
        </div>
        <div style="margin-top:16px;">
          <button type="button" class="btn-primary">–ü–æ–¥–æ–±—Ä–∞—Ç—å –∏–¥–µ–∏ (—Å–∫–æ—Ä–æ)</button>
        </div>
      </div>

      <!-- –¢–ê–ë 3: –ü–†–û–í–ï–†–ò–¢–¨ –ë–ò–õ–ï–¢ -->
      <div class="tab-content" id="tab-ticket">
        <p style="font-size:14px;margin-top:0;margin-bottom:12px;">
          –ó–¥–µ—Å—å –ø–æ—Ç–æ–º –±—É–¥–µ—Ç –≤–≤–æ–¥ –∫–æ–¥–∞ –±—Ä–æ–Ω–∏ –∏ –∞–Ω–∞–ª–∏–∑ —É–∂–µ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤:
          —Å—Ç—ã–∫–æ–≤–∫–∏, —Ä–∏—Å–∫–∏, —Å–æ–≤–µ—Ç—ã. –°–µ–π—á–∞—Å —ç—Ç–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞.
        </p>
        <div class="form-row">
          <div class="field" style="max-width:220px;">
            <label class="field-label">–ö–æ–¥ –±—Ä–æ–Ω–∏ / –Ω–æ–º–µ—Ä –±–∏–ª–µ—Ç–∞</label>
            <input class="field-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, AB12CD">
          </div>
          <div class="field" style="max-width:220px;">
            <label class="field-label">–ê–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è</label>
            <input class="field-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, Aeroflot">
          </div>
        </div>
        <div style="margin-top:16px;">
          <button type="button" class="btn-primary">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç (—Å–∫–æ—Ä–æ)</button>
        </div>
        <p style="font-size:13px;color:var(--text-secondary);margin-top:12px;">
          –î–∞–∂–µ —Å —É–∂–µ –∫—É–ø–ª–µ–Ω–Ω—ã–º–∏ –±–∏–ª–µ—Ç–∞–º–∏ Yuvia —Å–º–æ–∂–µ—Ç –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—Ç—Ä–µ—Å—Å,
          –ø–æ–¥—Å–≤–µ—Ç–∏—Ç—å —Ä–∏—Å–∫–∏ –ø–µ—Ä–µ—Å–∞–¥–æ–∫ –∏ —Å–æ–±—Ä–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç –ø–æ –≥–æ—Ä–æ–¥—É –ø–æ–¥ —Ç–≤–æ–∏ —á–∞—Å—ã.
        </p>
      </div>
    </section>
  </main>

  <!-- –Ω–∏–∂–Ω—è—è –ø–ª–∞—à–∫–∞ —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º –º–∞—Ä—à—Ä—É—Ç–æ–º -->
  <div class="trip-bar" id="trip-bar">
    <div>
      <div style="font-weight:600;" id="trip-title"></div>
      <div style="color:#6B7280;" id="trip-sub"></div>
    </div>
    <div style="text-align:right;">
      <div id="trip-price" style="font-weight:600;"></div>
      <div style="font-size:12px;color:#6B7280;">
        –ø–æ–∑–∂–µ —Å—é–¥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É ¬´–º–∞—Ä—à—Ä—É—Ç –ø–æ –≥–æ—Ä–æ–¥—É¬ª
      </div>
    </div>
  </div>

  <!-- —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ -->
  <div class="compare-drawer" id="compare-drawer">
    <div class="compare-header">
      <div id="compare-title">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤</div>
      <button type="button" style="border:none;background:transparent;cursor:pointer;font-size:12px;color:#6B7280;" id="compare-close-btn">
        –°–∫—Ä—ã—Ç—å
      </button>
    </div>
    <div class="compare-list" id="compare-list"></div>
  </div>

  <!-- –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ—Ç–∞–ª–µ–π -->
  <div class="modal-backdrop" id="modal-backdrop">
    <div class="modal">
      <div class="modal-header">
        <div>
          <div style="font-weight:600;font-size:16px;">–î–µ—Ç–∞–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞</div>
          <div style="font-size:13px;color:#6B7280;" id="modal-subtitle"></div>
        </div>
        <button type="button" class="btn-outline" id="modal-close-btn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
      <div id="modal-segments"></div>
      <div style="margin-top:8px;font-size:13px;color:#6B7280;">
        –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç ¬´–î–µ–Ω—å –≤—ã–ª–µ—Ç–∞¬ª –∏ —Å–æ–≤–µ—Ç—ã,
        —á—Ç–æ –¥–µ–ª–∞—Ç—å –≤ –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–µ –º–∞—Ä—à—Ä—É—Ç–∞: –æ—Ç –≤—Ö–æ–¥–∞ –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç –¥–æ –≤—ã—Ö–æ–¥–∞ –≤
        –≥–æ—Ä–æ–¥ –ø–æ –ø—Ä–∏–ª—ë—Ç—É.
      </div>
    </div>
  </div>
</div>

<script>
  // ==== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====
  function addMinutes(date, minutes) {
    return new Date(date.getTime() + minutes * 60000);
  }
  function minutesBetween(a, b) {
    return Math.round((b.getTime() - a.getTime()) / 60000);
  }
  function isNight(date) {
    var h = date.getHours();
    return h < 6 || h >= 23;
  }
  function computeStressForSegments(segments, prefs) {
    var score = 0;
    var tags = [];
    var hasNight = false;
    var hasOvernight = false;

    var first = new Date(segments[0].departTime);
    var last = new Date(segments[segments.length - 1].arriveTime);

    var totalDuration = minutesBetween(first, last);
    var connections = segments.length - 1;

    segments.forEach(function (s) {
      var d = new Date(s.departTime);
      var a = new Date(s.arriveTime);
      if (isNight(d) || isNight(a)) {
        hasNight = true;
        score += prefs.avoidNightFlights ? 2 : 1;
      }
    });

    for (var i = 0; i < segments.length - 1; i++) {
      var a = new Date(segments[i].arriveTime);
      var d = new Date(segments[i + 1].departTime);
      var conn = minutesBetween(a, d);
      if (conn < 50) {
        score += prefs.avoidShortConnections ? 3 : 2;
        tags.push('–ö–æ—Ä–æ—Ç–∫–∞—è —Å—Ç—ã–∫–æ–≤–∫–∞');
      } else if (conn < 90) {
        score += 1;
      } else if (conn > 240) {
        score += 1;
        tags.push('–î–æ–ª–≥–∞—è —Å—Ç—ã–∫–æ–≤–∫–∞');
      }
      if (conn > 480 && isNight(a) && !isNight(d)) {
        hasOvernight = true;
        score += prefs.avoidAirportOvernights ? 3 : 2;
        tags.push('–ù–æ—á—ë–≤–∫–∞ –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç—É');
      }
    }

    if (prefs.avoidEarlyDepartures && first.getHours() < 8) {
      score += 2;
      tags.push('–†–∞–Ω–Ω–∏–π –≤—ã–ª–µ—Ç');
    }
    if (prefs.avoidLateArrivals && last.getHours() > 23) {
      score += 2;
      tags.push('–ü–æ–∑–¥–Ω–µ–µ –ø—Ä–∏–±—ã—Ç–∏–µ');
    }

    if (connections >= 2) {
      score += prefs.afraidOfConnections ? 3 : 2;
      tags.push(connections + ' –ø–µ—Ä–µ—Å–∞–¥–∫–∏');
    } else if (connections === 1) {
      score += prefs.afraidOfConnections ? 2 : 1;
      tags.push('1 –ø–µ—Ä–µ—Å–∞–¥–∫–∞');
    } else {
      tags.push('–ë–µ–∑ –ø–µ—Ä–µ—Å–∞–¥–æ–∫');
    }

    if (totalDuration > 12 * 60) {
      score += 2;
      tags.push('–î–æ–ª–≥–∞—è –¥–æ—Ä–æ–≥–∞');
    }

    var normalized = Math.min(10, Math.round(score));
    return {
      stressScore: normalized,
      hasNightSegments: hasNight,
      hasAirportOvernight: hasOvernight,
      totalDurationMinutes: totalDuration,
      totalConnections: connections,
      tags: Array.from(new Set(tags))
    };
  }
  function getStressLabel(score) {
    if (score <= 3) return { label: '–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ç—Ä–µ—Å—Å', tone: 'low' };
    if (score <= 6) return { label: '–£–º–µ—Ä–µ–Ω–Ω—ã–π —Å—Ç—Ä–µ—Å—Å', tone: 'medium' };
    return { label: '–í—ã—Å–æ–∫–∏–π —Å—Ç—Ä–µ—Å—Å', tone: 'high' };
  }

  // ==== –ú–û–ö–û–í–û–ï "API" ====
  function createSegment(from, to, fromCode, toCode, depart, durationMin, airline, flightNumber, baggageIncluded, handLuggageOnly) {
    return {
      id: fromCode + '-' + toCode + '-' + flightNumber + '-' + depart.toISOString(),
      from: from,
      to: to,
      fromCode: fromCode,
      toCode: toCode,
      departTime: depart.toISOString(),
      arriveTime: addMinutes(depart, durationMin).toISOString(),
      airline: airline,
      flightNumber: flightNumber,
      baggageIncluded: baggageIncluded,
      handLuggageOnly: handLuggageOnly
    };
  }

  function searchFlightsMock(params) {
    var baseDate = new Date(params.departDate);
    baseDate.setHours(9, 0, 0, 0);

    var segmentsVariants = [];

    // 1. –ü—Ä—è–º–æ–π –¥–Ω–µ–≤–Ω–æ–π
    segmentsVariants.push([
      createSegment(params.from, params.to, 'FROM', 'TO', new Date(baseDate), 90, 'Yuvia Air', 'YA101', true, false)
    ]);

    // 2. –£—Ç—Ä–µ–Ω–Ω–∏–π —Å –ø–µ—Ä–µ—Å–∞–¥–∫–æ–π
    var morning = new Date(baseDate);
    morning.setHours(7);
    var seg2a = createSegment(params.from, '–ì–æ—Ä–æ–¥ –ø–µ—Ä–µ—Å–∞–¥–∫–∏', 'FROM', 'HUB', morning, 60, 'SkyHub', 'SH220', false, true);
    var seg2bDepart = addMinutes(new Date(seg2a.arriveTime), 55);
    var seg2b = createSegment('–ì–æ—Ä–æ–¥ –ø–µ—Ä–µ—Å–∞–¥–∫–∏', params.to, 'HUB', 'TO', seg2bDepart, 70, 'SkyHub', 'SH221', false, true);
    segmentsVariants.push([seg2a, seg2b]);

    // 3. –ù–æ—á–Ω–æ–π –ø—Ä—è–º–æ–π
    var night = new Date(baseDate);
    night.setHours(23);
    segmentsVariants.push([
      createSegment(params.from, params.to, 'FROM', 'TO', night, 100, 'NightLines', 'NL777', true, false)
    ]);

    // 4. –î–ª–∏–Ω–Ω—ã–π —Å –Ω–æ—á—ë–≤–∫–æ–π
    var eve = new Date(baseDate);
    eve.setHours(20);
    var seg4a = createSegment(params.from, '–ü–æ–∑–¥–Ω–∏–π —Ö–∞–±', 'FROM', 'H1', eve, 150, 'LongTrip', 'LT330', true, false);
    var seg4bDepart = addMinutes(new Date(seg4a.arriveTime), 9 * 60);
    var seg4b = createSegment('–ü–æ–∑–¥–Ω–∏–π —Ö–∞–±', params.to, 'H1', 'TO', seg4bDepart, 90, 'LongTrip', 'LT331', true, false);
    segmentsVariants.push([seg4a, seg4b]);

    var currency = 'RUB';
    var basePrice = 11467;

    var routes = segmentsVariants.map(function (segments, idx) {
      var stressInfo = computeStressForSegments(segments, params.preferences);
      var multipliers = [1, 0.9, 0.8, 1.15];
      var priceMultiplier = multipliers[idx] || 1;
      var price = Math.round(basePrice * priceMultiplier);
      var titles = [
        '–°–ø–æ–∫–æ–π–Ω—ã–π –¥–Ω–µ–≤–Ω–æ–π –±–µ–∑ –ø–µ—Ä–µ—Å–∞–¥–æ–∫',
        '–ë—ã—Å—Ç—Ä–æ, –Ω–æ —Å–æ —Å—Ç—ã–∫–æ–≤–∫–æ–π',
        '–ù–æ—á–Ω–æ–π –ø–µ—Ä–µ–ª—ë—Ç',
        '–î–ª–∏–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç —Å –Ω–æ—á—ë–≤–∫–æ–π'
      ];
      return {
        id: 'route-' + idx,
        title: titles[idx] || ('–ú–∞—Ä—à—Ä—É—Ç ' + (idx + 1)),
        price: price,
        currency: currency,
        segments: segments,
        stressScore: stressInfo.stressScore,
        hasNightSegments: stressInfo.hasNightSegments,
        hasAirportOvernight: stressInfo.hasAirportOvernight,
        totalDurationMinutes: stressInfo.totalDurationMinutes,
        totalConnections: stressInfo.totalConnections,
        tags: stressInfo.tags
      };
    });

    var priority = params.preferences.priority;
    routes.sort(function (a, b) {
      if (priority === 'price') {
        return a.price - b.price;
      } else if (priority === 'comfort') {
        return a.stressScore - b.stressScore;
      } else {
        return (a.price + a.stressScore * 500) - (b.price + b.stressScore * 500);
      }
    });

    return routes;
  }

  // ==== –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï ====
  var state = {
    routes: [],
    selectedRouteId: null,
    compareIds: [],
    searchParams: null,
    savedTrip: null,
    preferences: {
      priority: 'balance',
      avoidNightFlights: true,
      avoidShortConnections: true,
      avoidEarlyDepartures: false,
      avoidLateArrivals: false,
      afraidOfConnections: false,
      avoidAirportOvernights: true
    }
  };

  // ==== –¢–ê–ë–´ ====
  document.querySelectorAll('.tab-btn').forEach(function (btn) {
    btn.addEventListener('click', function () {
      var tab = btn.getAttribute('data-tab');
      document.querySelectorAll('.tab-btn').forEach(function (b) {
        b.classList.toggle('active', b === btn);
      });
      document.querySelectorAll('.tab-content').forEach(function (c) {
        c.classList.toggle('active', c.id === 'tab-' + tab);
      });
    });
  });

  // —Å–µ–≥–æ–¥–Ω—è—à–Ω—è—è –¥–∞—Ç–∞
  (function setToday() {
    var input = document.getElementById('date-input');
    var today = new Date();
    var iso = today.toISOString().slice(0, 10);
    input.value = iso;
  })();

  // –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
  document.querySelectorAll('.chip-toggle').forEach(function (chip) {
    chip.addEventListener('click', function () {
      var pr = chip.getAttribute('data-priority');
      state.preferences.priority = pr;
      document.querySelectorAll('.chip-toggle').forEach(function (c) {
        c.classList.toggle('active', c === chip);
      });
    });
  });

  // ==== –û–ë–†–ê–ë–û–¢–ö–ê –ü–û–ò–°–ö–ê ====
  var searchForm = document.getElementById('search-form');
  var searchBtn = document.getElementById('search-btn');
  var resultsBlock = document.getElementById('results-block');
  var routesListEl = document.getElementById('routes-list');
  var resultsCountEl = document.getElementById('results-count');
  var routesActionsEl = document.getElementById('routes-actions');
  var yuviaPanelEl = document.getElementById('yuvia-panel');

  searchForm.addEventListener('submit', function (e) {
    e.preventDefault();
    searchBtn.disabled = true;
    searchBtn.textContent = '–ü–æ–¥–±–∏—Ä–∞—é –≤–∞—Ä–∏–∞–Ω—Ç—ã‚Ä¶';

    var params = {
      from: document.getElementById('from-input').value || '–ì–æ—Ä–æ–¥ –≤—ã–ª–µ—Ç–∞',
      to: document.getElementById('to-input').value || '–ì–æ—Ä–æ–¥ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è',
      departDate: document.getElementById('date-input').value,
      flexibleDates: document.getElementById('flexible-input').checked,
      passengers: Number(document.getElementById('passengers-input').value) || 1,
      preferences: {
        priority: state.preferences.priority,
        avoidNightFlights: document.getElementById('pref-night').checked,
        avoidShortConnections: document.getElementById('pref-short').checked,
        avoidEarlyDepartures: false,
        avoidLateArrivals: false,
        afraidOfConnections: document.getElementById('pref-afraid').checked,
        avoidAirportOvernights: document.getElementById('pref-overnight').checked
      }
    };

    state.searchParams = params;
    state.compareIds = [];
    state.selectedRouteId = null;

    setTimeout(function () {
      state.routes = searchFlightsMock(params);
      if (state.routes.length > 0) {
        state.selectedRouteId = state.routes[0].id;
      }
      renderResults();
      searchBtn.disabled = false;
      searchBtn.textContent = '–ü–æ–¥–æ–±—Ä–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã';
    }, 500);
  });

  function renderResults() {
    if (!state.routes.length) {
      resultsBlock.style.display = 'none';
      return;
    }
    resultsBlock.style.display = 'block';
    resultsCountEl.textContent = '–ù–∞—à—ë–ª ' + state.routes.length + ' –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ–¥ —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å.';
    routesListEl.innerHTML = '';
    state.routes.forEach(function (route) {
      var card = document.createElement('div');
      card.className = 'route-card' + (route.id === state.selectedRouteId ? ' selected' : '');
      card.dataset.routeId = route.id;

      var header = document.createElement('div');
      header.className = 'route-card-header';

      var left = document.createElement('div');
      var title = document.createElement('div');
      title.className = 'route-title';
      title.textContent = route.title;
      left.appendChild(title);
      left.appendChild(createTimeline(route));

      var right = document.createElement('div');
      right.className = 'route-price-block';
      var price = document.createElement('div');
      price.className = 'route-price';
      price.textContent = route.price.toLocaleString('ru-RU') + ' ' + route.currency;
      right.appendChild(price);

      var compareBtn = document.createElement('button');
      compareBtn.type = 'button';
      compareBtn.className = 'btn-ghost' + (state.compareIds.indexOf(route.id) !== -1 ? ' active' : '');
      compareBtn.textContent = state.compareIds.indexOf(route.id) !== -1 ? '–í —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏' : '–°—Ä–∞–≤–Ω–∏—Ç—å';
      compareBtn.addEventListener('click', function (ev) {
        ev.stopPropagation();
        toggleCompare(route.id);
      });
      right.appendChild(compareBtn);

      header.appendChild(left);
      header.appendChild(right);
      card.appendChild(header);

      var badges = document.createElement('div');
      badges.style.display = 'flex';
      badges.style.gap = '8px';
      badges.style.flexWrap = 'wrap';
      badges.style.alignItems = 'center';
      badges.style.marginTop = '4px';

      var stress = getStressLabel(route.stressScore);
      var badgeBg = stress.tone === 'low' ? '#DCFCE7' : (stress.tone === 'medium' ? '#FEF3C7' : '#FEE2E2');
      var badgeColor = stress.tone === 'low' ? '#166534' : (stress.tone === 'medium' ? '#92400E' : '#B91C1C');

      var stressEl = document.createElement('span');
      stressEl.className = 'pill';
      stressEl.style.background = badgeBg;
      stressEl.style.color = badgeColor;
      stressEl.textContent = '–°—Ç—Ä–µ—Å—Å ' + route.stressScore + '/10 ‚Ä¢ ' + stress.label;
      badges.appendChild(stressEl);

      route.tags.slice(0, 4).forEach(function (tag) {
        var t = document.createElement('span');
        t.className = 'pill';
        t.style.border = '1px solid var(--border-soft)';
        t.style.color = '#6B7280';
        t.textContent = tag;
        badges.appendChild(t);
      });

      card.addEventListener('click', function () {
        state.selectedRouteId = route.id;
        renderResults();
      });

      card.appendChild(badges);
      routesListEl.appendChild(card);
    });

    routesActionsEl.style.display = state.routes.length ? 'block' : 'none';
    renderYuviaPanel();
    renderCompareDrawer();
  }

  function createTimeline(route) {
    var wrap = document.createElement('div');
    var first = new Date(route.segments[0].departTime);
    var last = new Date(route.segments[route.segments.length - 1].arriveTime);
    var totalMinutes = minutesBetween(first, last);

    var meta = document.createElement('div');
    meta.className = 'timeline-meta';
    var dot = document.createElement('span');
    dot.className = 'timeline-dot';
    meta.appendChild(dot);
    var text = document.createElement('span');
    text.textContent =
      route.segments[0].fromCode + ' ' + formatTime(route.segments[0].departTime) +
      ' ‚Äî ' +
      route.segments[route.segments.length - 1].toCode + ' ' + formatTime(route.segments[route.segments.length - 1].arriveTime) +
      ' ‚Ä¢ ' + Math.round(totalMinutes / 60) + ' —á';
    meta.appendChild(text);
    wrap.appendChild(meta);

    var bar = document.createElement('div');
    bar.className = 'timeline-bar';

    route.segments.forEach(function (s, idx) {
      var start = new Date(s.departTime);
      var end = new Date(s.arriveTime);
      var segMinutes = (end.getTime() - start.getTime()) / 60000;
      var width = (segMinutes / totalMinutes) * 100;

      var prevEnd = idx === 0 ? first : new Date(route.segments[idx - 1].arriveTime);
      var left = (minutesBetween(first, prevEnd) / totalMinutes) * 100;

      var segEl = document.createElement('div');
      segEl.className = 'timeline-segment';
      segEl.style.left = left + '%';
      segEl.style.width = width + '%';
      segEl.style.background = idx % 2 === 0 ? 'var(--accent-primary)' : 'var(--accent-secondary)';
      bar.appendChild(segEl);
    });

    wrap.appendChild(bar);
    return wrap;
  }

  function formatTime(iso) {
    var d = new Date(iso);
    return d.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
  }

  // ==== –ü–ê–ù–ï–õ–¨ YUVIA ====
  function renderYuviaPanel() {
    var route = state.routes.find(function (r) { return r.id === state.selectedRouteId; });
    yuviaPanelEl.innerHTML = '';

    var title = document.createElement('div');
    title.className = 'yuvia-panel-title';
    title.textContent = 'Yuvia —Ä—è–¥–æ–º';
    yuviaPanelEl.appendChild(title);

    if (!route) {
      var p = document.createElement('p');
      p.style.fontSize = '14px';
      p.style.margin = '0';
      p.textContent = '–ó–∞–ø–æ–ª–Ω–∏ –±—Ä–∏—Ñ —Å–ª–µ–≤–∞ ‚Äî —è –ø–æ–¥–±–µ—Ä—É –º–∞—Ä—à—Ä—É—Ç—ã –ø–æ–¥ —Ç–≤–æ–π —Å—Ç–∏–ª—å, –∞ –∑–∞—Ç–µ–º —á–µ—Å—Ç–Ω–æ —Ä–∞—Å—Å–∫–∞–∂—É, —á–µ–≥–æ –∂–¥–∞—Ç—å –æ—Ç –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞. –ë–µ–∑ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–æ–π –º–∏—à—É—Ä—ã.';
      yuviaPanelEl.appendChild(p);

      var footer = document.createElement('div');
      footer.className = 'yuvia-footer';
      footer.textContent = '–í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è ¬´—Ä–µ–∂–∏–º –¥–Ω—è –≤—ã–ª–µ—Ç–∞¬ª —Å —á–µ–∫-–ª–∏—Å—Ç–∞–º–∏ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏, –∞ —Ç–∞–∫–∂–µ —Å–æ–≤–µ—Ç—ã, —á—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Ä–µ–π—Å –∑–∞–¥–µ—Ä–∂–∞—Ç.';
      yuviaPanelEl.appendChild(footer);
      return;
    }

    var bubble = document.createElement('div');
    bubble.className = 'yuvia-bubble';

    var stress = getStressLabel(route.stressScore);
    var durationHours = Math.round(route.totalDurationMinutes / 60);
    var connectionsText = route.totalConnections === 0
      ? '–±–µ–∑ –ø–µ—Ä–µ—Å–∞–¥–æ–∫'
      : (route.totalConnections === 1 ? '—Å –æ–¥–Ω–æ–π –ø–µ—Ä–µ—Å–∞–¥–∫–æ–π' : ('—Å ' + route.totalConnections + ' –ø–µ—Ä–µ—Å–∞–¥–∫–∞–º–∏'));

    var intro;
    if (stress.tone === 'low') {
      intro = '–≠—Ç–æ —Å–ø–æ–∫–æ–π–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π.';
    } else if (stress.tone === 'medium') {
      intro = '–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –±–∞–ª–∞–Ω—Å–∏—Ä—É–µ—Ç –º–µ–∂–¥—É —Ü–µ–Ω–æ–π –∏ –∫–æ–º—Ñ–æ—Ä—Ç–æ–º.';
    } else {
      intro = '–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –Ω–µ—Ä–≤–Ω—ã–π, –Ω–æ –∏–Ω–æ–≥–¥–∞ –µ–≥–æ –≤—ã–±–∏—Ä–∞—é—Ç —Ä–∞–¥–∏ —Ü–µ–Ω—ã –∏–ª–∏ –∂—ë—Å—Ç–∫–∏—Ö —Å—Ä–æ–∫–æ–≤.';
    }

    bubble.innerHTML =
      '<div style="margin-bottom:6px;">' + intro + '</div>' +
      '<div style="margin-bottom:6px;">–í –ø—É—Ç–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ <b>' + durationHours + ' —á</b>, ' + connectionsText +
      '. –°—Ç—Ä–µ—Å—Å <b>' + route.stressScore + '/10</b> ‚Äî ' + stress.label.toLowerCase() + '.</div>';

    if (route.hasAirportOvernight) {
      var warn = document.createElement('div');
      warn.style.color = '#92400E';
      warn.textContent = '–ù–æ—á—ë–≤–∫–∞ –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç—É ‚Äî —ç—Ç–æ –∏—Å–ø—ã—Ç–∞–Ω–∏–µ –¥–∞–∂–µ –¥–ª—è –æ–ø—ã—Ç–Ω—ã—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤. –ï—Å–ª–∏ –≤–∞–∂–Ω–æ –≤—ã—Å–ø–∞—Ç—å—Å—è –∏ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è —Å–ø–æ–∫–æ–π–Ω–æ, —è –±—ã –ø–æ—Å–º–æ—Ç—Ä–µ–ª –¥—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã.';
      bubble.appendChild(warn);
    } else if (route.hasNightSegments) {
      var note = document.createElement('div');
      note.textContent = '–ï—Å—Ç—å –Ω–æ—á–Ω–æ–π –ø–µ—Ä–µ–ª—ë—Ç. –î–ª—è –∫–æ–≥–æ-—Ç–æ —ç—Ç–æ —É–¥–æ–±–Ω–æ, –µ—Å–ª–∏ —É–¥–∞—ë—Ç—Å—è –ø–æ—Å–ø–∞—Ç—å –≤ —Å–∞–º–æ–ª—ë—Ç–µ, –Ω–æ –µ—Å–ª–∏ —Ç—ã –Ω–µ –ª—é–±–∏—à—å –Ω–æ—á–Ω—ã–µ —Ä–µ–π—Å—ã ‚Äî –ª—É—á—à–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –¥–Ω–µ–≤–Ω—ã–µ.';
      bubble.appendChild(note);
    }

    yuviaPanelEl.appendChild(bubble);

    if (state.searchParams) {
      var ctx = document.createElement('div');
      ctx.style.fontSize = '13px';
      ctx.innerHTML =
        '<div style="margin-bottom:4px;">–ú–∞—Ä—à—Ä—É—Ç—ã –ø–æ–¥ —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å: <b>' +
        state.searchParams.from + ' ‚Üí ' + state.searchParams.to +
        '</b>, –¥–∞—Ç–∞ –≤—ã–ª–µ—Ç–∞ <b>' + state.searchParams.departDate + '</b>.</div>' +
        '<div style="color:#6B7280;">–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å—Ç–∏–ª—è —Ç—ã —Å–µ–π—á–∞—Å –∞–∫—Ü–µ–Ω—Ç–∏—Ä—É–µ—à—å—Å—è –Ω–∞ ' +
        (state.searchParams.preferences.priority === 'price'
          ? '—ç–∫–æ–Ω–æ–º–∏–∏'
          : state.searchParams.preferences.priority === 'comfort'
          ? '–∫–æ–º—Ñ–æ—Ä—Ç–µ –∏ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–∏'
          : '–±–∞–ª–∞–Ω—Å–µ —Ü–µ–Ω—ã –∏ —É–¥–æ–±—Å—Ç–≤–∞') +
        '. –≠—Ç–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.</div>';
      yuviaPanelEl.appendChild(ctx);
    }

    var footer = document.createElement('div');
    footer.className = 'yuvia-footer';
    footer.textContent = '–í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è ¬´—Ä–µ–∂–∏–º –¥–Ω—è –≤—ã–ª–µ—Ç–∞¬ª –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —à–∞–≥—É –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç—É.';
    yuviaPanelEl.appendChild(footer);
  }

  // ==== –°–†–ê–í–ù–ï–ù–ò–ï ====
  var compareDrawerEl = document.getElementById('compare-drawer');
  var compareListEl = document.getElementById('compare-list');
  var compareTitleEl = document.getElementById('compare-title');
  var compareCloseBtn = document.getElementById('compare-close-btn');

  compareCloseBtn.addEventListener('click', function () {
    state.compareIds = [];
    renderResults();
  });

  function toggleCompare(id) {
    var idx = state.compareIds.indexOf(id);
    if (idx === -1) {
      state.compareIds.push(id);
    } else {
      state.compareIds.splice(idx, 1);
    }
    renderResults();
  }

  function renderCompareDrawer() {
    if (!state.compareIds.length) {
      compareDrawerEl.classList.remove('active');
      return;
    }
    compareDrawerEl.classList.add('active');
    var routes = state.routes.filter(function (r) { return state.compareIds.indexOf(r.id) !== -1; });
    compareTitleEl.textContent = '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ (' + routes.length + ')';
    compareListEl.innerHTML = '';
    routes.forEach(function (r) {
      var card = document.createElement('div');
      card.className = 'compare-card';
      card.innerHTML =
        '<div style="font-weight:600;margin-bottom:4px;">' + r.title + '</div>' +
        '<div style="font-size:12px;color:#6B7280;">' +
        (r.totalConnections === 0 ? '–ë–µ–∑ –ø–µ—Ä–µ—Å–∞–¥–æ–∫' : (r.totalConnections + ' –ø–µ—Ä–µ—Å–∞–¥.')) +
        ' ‚Ä¢ ' + Math.round(r.totalDurationMinutes / 60) + ' —á –≤ –ø—É—Ç–∏</div>' +
        '<div style="margin-top:6px;"><b>' + r.price.toLocaleString('ru-RU') + '</b> ' + r.currency + '</div>' +
        '<div style="margin-top:4px;font-size:12px;">–°—Ç—Ä–µ—Å—Å: <b>' + r.stressScore + '/10</b></div>';
      compareListEl.appendChild(card);
    });
  }

  // ==== TRIP BAR ====
  var tripBarEl = document.getElementById('trip-bar');
  var tripTitleEl = document.getElementById('trip-title');
  var tripSubEl = document.getElementById('trip-sub');
  var tripPriceEl = document.getElementById('trip-price');

  var TRIP_KEY = 'yuvia_last_trip_singlefile_v1';

  function loadTrip() {
    try {
      var raw = localStorage.getItem(TRIP_KEY);
      if (!raw) return;
      state.savedTrip = JSON.parse(raw);
      renderTripBar();
    } catch (e) {}
  }
  function saveTrip(trip) {
    state.savedTrip = trip;
    try {
      localStorage.setItem(TRIP_KEY, JSON.stringify(trip));
    } catch (e) {}
    renderTripBar();
  }
  function renderTripBar() {
    if (!state.savedTrip) {
      tripBarEl.classList.remove('active');
      return;
    }
    var t = state.savedTrip;
    var route = t.route;
    tripBarEl.classList.add('active');
    tripTitleEl.textContent = '–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –ø–æ–µ–∑–¥–∫–∏ ‚Ä¢ ' + t.searchParams.from + ' ‚Üí ' + t.searchParams.to;
    tripSubEl.textContent = route.title + ' ‚Ä¢ ' + Math.round(route.totalDurationMinutes / 60) + ' —á –≤ –ø—É—Ç–∏ ‚Ä¢ —Å—Ç—Ä–µ—Å—Å ' + route.stressScore + '/10';
    tripPriceEl.textContent = route.price.toLocaleString('ru-RU') + ' ' + route.currency;
  }
  loadTrip();

  document.getElementById('details-btn').addEventListener('click', function () {
    var route = state.routes.find(function (r) { return r.id === state.selectedRouteId; });
    if (!route) return;
    openModal(route);
  });
  document.getElementById('save-trip-btn').addEventListener('click', function () {
    if (!state.searchParams) return;
    var route = state.routes.find(function (r) { return r.id === state.selectedRouteId; });
    if (!route) return;
    var trip = {
      id: 'trip-' + Date.now(),
      createdAt: new Date().toISOString(),
      searchParams: state.searchParams,
      route: route
    };
    saveTrip(trip);
  });

  // ==== –ú–û–î–ê–õ–ö–ê ====
  var modalBackdropEl = document.getElementById('modal-backdrop');
  var modalSubtitleEl = document.getElementById('modal-subtitle');
  var modalSegmentsEl = document.getElementById('modal-segments');
  var modalCloseBtn = document.getElementById('modal-close-btn');

  modalCloseBtn.addEventListener('click', closeModal);
  modalBackdropEl.addEventListener('click', function (e) {
    if (e.target === modalBackdropEl) closeModal();
  });

  function openModal(route) {
    modalSubtitleEl.textContent = route.title;
    modalSegmentsEl.innerHTML = '';
    route.segments.forEach(function (s, idx) {
      var card = document.createElement('div');
      card.className = 'segment-card';
      card.innerHTML =
        '<div style="display:flex;justify-content:space-between;font-size:14px;font-weight:500;margin-bottom:4px;">' +
        '<span>' + s.fromCode + ' ‚Üí ' + s.toCode + '</span>' +
        '<span>' + formatDate(s.departTime) + ' ‚Ä¢ ' + formatTime(s.departTime) + ' ‚Äî ' + formatTime(s.arriveTime) + '</span>' +
        '</div>' +
        '<div style="font-size:13px;">' + s.airline + ' ‚Ä¢ —Ä–µ–π—Å ' + s.flightNumber + '</div>' +
        '<div style="font-size:12px;color:#6B7280;margin-top:4px;">' +
        (s.baggageIncluded ? '–ë–∞–≥–∞–∂ –≤–∫–ª—é—á—ë–Ω' : (s.handLuggageOnly ? '–¢–æ–ª—å–∫–æ —Ä—É—á–Ω–∞—è –∫–ª–∞–¥—å' : '–£—Ç–æ—á–Ω–∏—Ç–µ —É—Å–ª–æ–≤–∏—è –±–∞–≥–∞–∂–∞')) +
        ' ‚Ä¢ –í –∞—ç—Ä–æ–ø–æ—Ä—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –≤—ã–µ–∑–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º –∑–∞ 2‚Äì2,5 —á–∞—Å–∞ –¥–æ –≤—ã–ª–µ—Ç–∞.' +
        (idx === 0 ? ' –û–Ω–ª–∞–π–Ω-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—ã—á–Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∑–∞ 24 —á–∞—Å–∞ ‚Äî –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤—ã–±—Ä–∞—Ç—å –º–µ—Å—Ç–∞.' : '') +
        '</div>';
      modalSegmentsEl.appendChild(card);
    });
    modalBackdropEl.classList.add('active');
  }
  function closeModal() {
    modalBackdropEl.classList.remove('active');
  }
  function formatDate(iso) {
    var d = new Date(iso);
    return d.toLocaleDateString('ru-RU', { day: '2-digit', month: 'short' });
  }
</script>
</body>
</html>
